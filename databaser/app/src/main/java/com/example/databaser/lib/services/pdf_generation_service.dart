\nimport \'package:pdf/pdf.dart\';\nimport \'package:pdf/widgets.dart\' as pw;\nimport \'package:printing/printing.dart\';\nimport \'../data/local/database/database.dart\'; // Assuming your models are in here\n\nclass PdfGenerationService {\n  Future<void> generateInvoicePdf(\n    Document document, \n    Customer customer,\n    List<LineItem> lineItems,\n    BusinessProfile businessProfile\n  ) async {\n    final pdf = pw.Document();\n\n    final pw.ThemeData theme = pw.ThemeData.withFont(\n      base: await PdfGoogleFonts.openSansRegular(),\n      bold: await PdfGoogleFonts.openSansBold(),\n    );\n\n    pdf.addPage(\n      pw.Page(\n        theme: theme,\n        pageFormat: PdfPageFormat.a4,\n        build: (pw.Context context) {\n          return pw.Column(\n            crossAxisAlignment: pw.CrossAxisAlignment.start,\n            children: [\n              _buildHeader(context, document, customer, businessProfile),\n              pw.SizedBox(height: 20),\n              _buildLineItemsTable(context, lineItems, businessProfile.isGstRegistered),\n              pw.Spacer(),\n              _buildFooter(context, businessProfile),\n            ],\n          );\n        },\n      ),\n    );\n\n    await Printing.layoutPdf(\n        onLayout: (PdfPageFormat format) async => pdf.save());\n  }\n\n  pw.Widget _buildHeader(pw.Context context, Document document, Customer customer, BusinessProfile businessProfile) {\n    final String title = document.type == \'Invoice\' && businessProfile.isGstRegistered \n      ? \'Tax Invoice\' \n      : document.type;\n\n    return pw.Row(\n      mainAxisAlignment: pw.MainAxisAlignment.spaceBetween,\n      crossAxisAlignment: pw.CrossAxisAlignment.start,\n      children: [\n        pw.Column(\n          crossAxisAlignment: pw.CrossAxisAlignment.start,\n          children: [\n            pw.Text(\'To:\'),\n            pw.Text(customer.name, style: pw.TextStyle(fontWeight: pw.FontWeight.bold)),\n            if (customer.businessName != null) pw.Text(customer.businessName!),\n            pw.Text(customer.address),\n            pw.Text(customer.email),\n            pw.Text(customer.phone),\n            if (customer.abnOrAcn != null) pw.Text(\'ABN/ACN: ${customer.abnOrAcn}\'),\n          ],\n        ),\n        pw.Column(\n          crossAxisAlignment: pw.CrossAxisAlignment.end,\n          children: [\n            pw.Text(title.toUpperCase(), style: pw.TextStyle(fontSize: 24, fontWeight: pw.FontWeight.bold)),\n            pw.Text(\'Ref: ${document.referenceNumber}\'),\n            pw.SizedBox(height: 10),\n            pw.Text(businessProfile.businessName, style: pw.TextStyle(fontWeight: pw.FontWeight.bold)),\n            pw.Text(\'ABN/ACN: ${businessProfile.abnOrAcn}\'),\n            pw.Text(businessProfile.contactInfo),\n          ],\n        )\n      ],\n    );\n  }\n\n  pw.Widget _buildLineItemsTable(pw.Context context, List<LineItem> lineItems, bool isGstRegistered) {\n    final headers = [\'Description\', \'Qty\', \'Unit Price\', \'Subtotal\'];\n\n    final data = lineItems.map((item) {\n      return [item.description, item.quantity.toString(), item.unitPrice.toStringAsFixed(2), item.subtotal.toStringAsFixed(2)];\n    }).toList();\n\n    final double total = lineItems.fold(0, (sum, item) => sum + item.subtotal);\n    final double gstAmount = total * 0.1; // Assuming 10% GST\n\n    return pw.Column(\n      crossAxisAlignment: pw.CrossAxisAlignment.end,\n      children: [\n        pw.Table.fromTextArray(\n          headers: headers,\n          data: data,\n          border: pw.TableBorder.all(),\n          headerStyle: pw.TextStyle(fontWeight: pw.FontWeight.bold),\n          cellAlignment: pw.Alignment.centerLeft,\n          cellAlignments: {3: pw.Alignment.centerRight},\n          headerDecoration: const pw.BoxDecoration(\n            color: PdfColors.grey300,\n          ),\n        ),\n        pw.SizedBox(height: 10),\n        if (isGstRegistered) ...[\n          pw.Text(\'Subtotal: \$${(total - gstAmount).toStringAsFixed(2)}\'),\n          pw.Text(\'GST: \$${gstAmount.toStringAsFixed(2)}\'),\n        ],\n        pw.Divider(),\n        pw.Text(\'Total: \$${total.toStringAsFixed(2)}\', style: pw.TextStyle(fontWeight: pw.FontWeight.bold)),\n      ],\n    );\n  }\n\n  pw.Widget _buildFooter(pw.Context context, BusinessProfile businessProfile) {\n    return pw.Column(\n      crossAxisAlignment: pw.CrossAxisAlignment.start,\n      children: [\n        pw.Divider(),\n        pw.SizedBox(height: 10),\n        pw.Text(\'Bank Details:\', style: pw.TextStyle(fontWeight: pw.FontWeight.bold)),\n        pw.Text(\'BSB: ${businessProfile.bankingDetailsBsb}\'),\n        pw.Text(\'Account: ${businessProfile.bankingDetailsAcc}\'),\n        pw.SizedBox(height: 10),\n        pw.Text(\'Terms: Payment due within 14 days.\'), // Example terms\n      ]\n    );\n  }\n}\n